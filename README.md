# FoodBot

Telegram-бот с ИИ, который помогает выбирать еду, предлагать блюда и сочетания продуктов. Хранит историю диалогов пользователей в Redis через FSM.

## Возможности

### Команды пользователя

* “ИИ” — запуск режима общения с ботом по еде.
* `/info` — история последних сообщений.
* `/del_my_info` — удалить свою историю.

### Команды админа

* `/get_all_key` — все ключи Redis.
* `/get_info_id` — история по ID.
* `/del_info_id` — удалить историю по ID.
* `/cls` — очистить всю БД.

## Используемые технологии

* Python, Aiogram 3
* Redis + aiogram-fsm-storage-redis
* LangChain + FAISS
* LLaMA 3.1 (через localhost)
* Асинхронный фреймворк для создания Telegram ботов.


## Как работает бот (пример полного цикла)

Ниже описан полный цикл работы Telegram-бота по выбору еды

---

### Пример полного цикла

#### Пользователь:

Отправляет боту:

```text
Что мне съесть на обед
```

---

#### Бот:

Передаёт запрос в **RAG-модуль**.

---

#### RAG-модуль:

* Векторизует запрос (эмбеддинг для: `"Что мне съесть на обед"`).
* Ищет подходящие записи в Redis (например, в файле `lunch.txt`).
* Находит блюда:

  * **Сэндвичи с курицей** — сытный вариант для обеда.
  * **Овощные роллы** — лёгкий и свежий вариант.
* Извлекает историю общения пользователя (FSM, Redis).

---

#### Redis
* Получает запрос на историю
* Форматирует её
* Возвращает

#### ИИ-модель:

Получает сгенерированный **prompt**:

```text
Ты — кулинарный помощник.
...
История диалога:
Пользователь: Что мне съесть на обед?

База знаний:
1. Сэндвичи с курицей — сытный вариант для обеда.
2. Овощные роллы — лёгкий и свежий вариант.

Сообщение пользователя:
Что мне съесть на обед?
```

Генерирует ответ:

```text
На обед могу порекомендовать:

**1) Сэндвичи с курицей** — сытный и быстрый вариант с куриной грудкой, салатом и хлебом.

**2) Овощные роллы** — лёгкие и свежие, с морковью, огурцом и рисовой бумагой.
```

---

#### Бот:

Отправляет ответ пользователю, сохраняет его в истории:

```text
На обед могу порекомендовать:

**1) Сэндвичи с курицей** — сытный и быстрый вариант с куриной грудкой, салатом и хлебом.

**2) Овощные роллы** — лёгкие и свежие, с морковью, огурцом и рисовой бумагой.
```
![Схема полного цикла](/docs/img/Безымянный-2025-07-05-2026.png)


## Запуск

### Запуск через Docker

#### 0. Утановка env переменных, создайте в файл .env и подставте свои значания


#### 1. Перейти в папку с проектом и выполнить комманду:
```bash
docker build -t my_project .
```

#### 2. Запуск контейнера
```bash
docker run my_project
```
### Запуск через python

#### 1. Склонируйте репозиторий 
```bash
git clone -b not_multiag https://github.com/IvanSemenkin/praktika-tg-bot-restauran.git
```
#### 2. Установите зависимости 
```bash
pip install .
```
#### 3. Запустите проект
```bash
python main.py
```

## Автор

**Иван Семенкин**  
[isemenkin@gmail.com](mailto:isemenkin@gmail.com)

[GitHub](https://github.com/IvanSemenkin)







## Структура проекта

```bash
food-combo-bot/
│
├── main.py
├── docs/
│   ├── pyproject.toml
│   └── README.md
├── knowledge_base/
│   ├── cuisine/
│   ├── dishes/
│   ├── meal_time/
│   ├── situation/
│   ├── taste/
│   └── weather/
├── src/
│   ├── bot/
│   │   ├── ai.py
│   │   ├── handlers.py
│   │   ├── hendlers.py
│   │   ├── keyboards.py
│   │   └── states.py
│   └── storage/
│       ├── utils/
│       │   ├── log_user_action.py
│       │   ├── logger.py
│       │   └── prompt.py
```